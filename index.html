<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathematical Morphology in Any Number of Dimensions • mmand</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Mathematical Morphology in Any Number of Dimensions">
<meta property="og:description" content="Provides tools for performing mathematical morphology
        operations, such as erosion and dilation, on data of arbitrary
        dimensionality. Can also be used for finding connected
        components, resampling, filtering, smoothing and other image
        processing-style operations.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mmand</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonclayden/mmand/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="mathematical-morphology-in-any-number-of-dimensions" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#mathematical-morphology-in-any-number-of-dimensions" class="anchor" aria-hidden="true"></a>Mathematical Morphology in Any Number of Dimensions</h1></div>
<p>The <code>mmand</code> R package provides tools for performing mathematical morphology operations, such as erosion and dilation, or finding connected components, on arrays of arbitrary dimensionality. It can also smooth and resample arrays, obtaining values between pixel centres or scaling the image up or down wholesale.</p>
<p>All of these operations are underpinned by three powerful functions, which perform different types of kernel-based operations: <code><a href="reference/morph.html">morph()</a></code>, <code><a href="reference/components.html">components()</a></code> and <code><a href="reference/resample.html">resample()</a></code>.</p>
<div id="contents" class="section level2">
<h2 class="hasAnchor">
<a href="#contents" class="anchor" aria-hidden="true"></a>Contents</h2>
<ul>
<li><a href="#test-image">Test image</a></li>
<li><a href="#mathematical-morphology">Mathematical morphology</a></li>
<li><a href="#greyscale-morphology">Greyscale morphology</a></li>
<li><a href="#skeletonisation">Skeletonisation</a></li>
<li><a href="#smoothing">Smoothing</a></li>
<li><a href="#connected-components">Connected components</a></li>
<li><a href="#the-distance-transform">The distance transform</a></li>
<li><a href="#resampling">Resampling</a></li>
</ul>
</div>
<div id="test-image" class="section level2">
<h2 class="hasAnchor">
<a href="#test-image" class="anchor" aria-hidden="true"></a>Test image</h2>
<p>A test image of a jet engine fan is available within the package, and will be used for demonstration below. It can be read in and displayed using the code</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/mmand" class="external-link">mmand</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/loder" class="external-link">loder</a></span><span class="op">)</span>

<span class="va">fan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/loder/man/readPng.html" class="external-link">readPng</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"fan.png"</span>, package<span class="op">=</span><span class="st">"mmand"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="va">fan</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-1.png" alt=""><p class="caption">plot of chunk fan</p>
</div>
<p>Here we are using the <a href="https://github.com/jonclayden/loder" class="external-link">loder</a> package to read the PNG file.</p>
</div>
<div id="mathematical-morphology" class="section level2">
<h2 class="hasAnchor">
<a href="#mathematical-morphology" class="anchor" aria-hidden="true"></a>Mathematical morphology</h2>
<p><a href="http://en.wikipedia.org/wiki/Mathematical_morphology" class="external-link">Mathematical morphology</a> is an image processing technique that can be used to emphasise or remove certain types of features from binary or greyscale images. It is classically performed on two-dimensional images, but can be useful in three or more dimensions, as, for example, in medical image analysis. The <code>mmand</code> package can work on R arrays of any dimensionality, including one-dimensional vectors.</p>
<p>The basic operations in mathematical morphology are <em>erosion</em> and <em>dilation</em>. A simple one-dimensional example serves to illustrate their effects:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>
<span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">)</span>
<span class="co">##  [1] 0 0 0 0 0 0 0 1 0 0 0</span>
<span class="fu"><a href="reference/morphology.html">dilate</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">)</span>
<span class="co">##  [1] 0 1 1 1 0 1 1 1 1 1 0</span></code></pre></div>
<p>The <code><a href="reference/morphology.html">erode()</a></code> function “thins out” areas in the input vector, <code>x</code>, which were “on” (i.e. set to 1), to the point where the first of these areas “disappears” entirely. Conversely, the <code><a href="reference/morphology.html">dilate()</a></code> function expands these regions into neighbouring pixels.</p>
<p>The vector <code>k</code> here is called the <em>kernel</em> or <em>structuring element</em>. It effectively controls the region of influence of the operation when it is applied to each value.</p>
<p>Derived from these basic operations are the <em>opening</em> and <em>closing</em> functions. These apply both basic operations, using the same kernel, but in different orders: an opening is an erosion followed by a dilation, whereas a closing is a dilation followed by an opening.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/morphology.html">opening</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">)</span>
<span class="co">##  [1] 0 0 0 0 0 0 1 1 1 0 0</span>
<span class="fu"><a href="reference/morphology.html">closing</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">)</span>
<span class="co">##  [1] 0 0 1 0 0 0 1 1 1 0 0</span></code></pre></div>
<p>Notice that, in this case, the closing gets us back to where we started, whereas the opening does not. This is because the initial erosion operation removes the first “on” block entirely, so it cannot be recovered by the subsequent dilation. Hence, the effect is to remove small features that are narrower than the kernel.</p>
</div>
<div id="greyscale-morphology" class="section level2">
<h2 class="hasAnchor">
<a href="#greyscale-morphology" class="anchor" aria-hidden="true"></a>Greyscale morphology</h2>
<p>Mathematical morphology is not limited to binary data. When generalised to greyscale images, erosion replaces each nonzero pixel with the minimum value within the kernel when it is centred at that pixel, and dilation uses the maximum. For example,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>,<span class="fl">0.3</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">)</span>
<span class="co">##  [1] 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.2 0.0 0.0 0.0</span></code></pre></div>
<p>Notice that the remaining nonzero value is now reduced from 0.5 to 0.2, the minimum value across the original pixel and its neighbours on either side. With a wider kernel, its final value would have dropped to zero.</p>
<p>The effect is more intuitively demonstrated on a real two-dimensional image:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">fan</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-eroded-1.png" alt=""><p class="caption">plot of chunk fan-eroded</p>
</div>
<p>Notice that darker areas appear enlarged. In this case the kernel is itself a 2D array (or matrix), and unlike the 1D case there is a choice of plausible shapes for a particular width. The <code><a href="reference/kernels.html">shapeKernel()</a></code> function will create box, disc and diamond shaped kernels, and their higher-dimensional equivalents.</p>
<p>Using a wider kernel exaggerates the effect:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">7</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">fan</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-eroded77-1.png" alt=""><p class="caption">plot of chunk fan-eroded77</p>
</div>
<p>In the case above, the diamond shape of the kernel is obvious in areas where the kernel is larger than the eroded features.</p>
<p>Note that the kernel may also be anisotropic, i.e. it may have a different width in each dimension:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">fan</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-eroded73-1.png" alt=""><p class="caption">plot of chunk fan-eroded73</p>
</div>
<p>The effect of dilation is complementary, shrinking dark regions and enlarging bright ones:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/morphology.html">dilate</a></span><span class="op">(</span><span class="va">fan</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-dilated-1.png" alt=""><p class="caption">plot of chunk fan-dilated</p>
</div>
<p>In this case the low-intensity and narrow handwriting towards the middle of the fan has all but disappeared.</p>
<p>The basic operations can be combined together for other useful purposes. For example, the difference between the dilated and eroded versions of an image, known as the <em>morphological gradient</em>, can be used to show up edges between areas of light and dark.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/morphology.html">dilate</a></span><span class="op">(</span><span class="va">fan</span>,<span class="va">k</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="reference/morphology.html">erode</a></span><span class="op">(</span><span class="va">fan</span>,<span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-gradient-1.png" alt=""><p class="caption">plot of chunk fan-gradient</p>
</div>
<p>The <a href="http://en.wikipedia.org/wiki/Sobel_operator" class="external-link">Sobel filter</a> has a similar effect.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/filters.html">sobelFilter</a></span><span class="op">(</span><span class="va">fan</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-sobel-1.png" alt=""><p class="caption">plot of chunk fan-sobel</p>
</div>
</div>
<div id="skeletonisation" class="section level2">
<h2 class="hasAnchor">
<a href="#skeletonisation" class="anchor" aria-hidden="true"></a>Skeletonisation</h2>
<p><a href="https://en.wikipedia.org/wiki/Topological_skeleton" class="external-link">Topological skeletonisation</a> is the process of thinning a shape to a medial line or surface representing the approximate path of the original. It can be thought of as the result of repeated erosion, up to the point where only a “core” of the shape exists. It is usually applied to binary data.</p>
<p>As of version 1.5.0, the <code>mmand</code> package offers three different skeletonisation algorithms, with different advantages and limitations. (Please see the documentation at <code><a href="reference/skeletonise.html">?skeletonise</a></code> for details.) Below we see the results of applying each of them in turn to the outline of a capital letter B.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/loder" class="external-link">loder</a></span><span class="op">)</span>
<span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/loder/man/readPng.html" class="external-link">readPng</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"B.png"</span>, package<span class="op">=</span><span class="st">"mmand"</span><span class="op">)</span><span class="op">)</span>
<span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"diamond"</span><span class="op">)</span>

<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/skeletonise.html">skeletonise</a></span><span class="op">(</span><span class="va">B</span>,<span class="va">k</span>,method<span class="op">=</span><span class="st">"lantuejoul"</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"red"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/skeletonisation.png" alt=""><p class="caption">Skeletonised capital B</p>
</div>
<p>The B is shown alone first, and then with the three skeletons overlaid in red. (Only the code for generating the first is shown.) Notice that all three skeletons are reasonable medial paths, but the centre one (using Beucher’s formula) is a little thicker than the others in most places, and only the right one (using the hit-or-miss transform) is fully self-connected.</p>
</div>
<div id="smoothing" class="section level2">
<h2 class="hasAnchor">
<a href="#smoothing" class="anchor" aria-hidden="true"></a>Smoothing</h2>
<p>A loosely related operation is <a href="http://en.wikipedia.org/wiki/Kernel_smoother" class="external-link">kernel-based smoothing</a>, often used to ameliorate noise. In this case the kernel is used as a set of coefficients, which are multiplied by data within the neighbourhood of each pixel and added together. For these purposes the kernel should usually be normalised, so that its values add up to one.</p>
<p>Gaussian smoothing is a typical example, wherein our coefficients are given by the probability densities of a Gaussian distribution centred at the middle of the kernel. The <code>mmand</code> package provides the <code><a href="reference/gaussianSmooth.html">gaussianSmooth()</a></code> function for performing this operation. Below we can see an example in one dimension, where we create some noisy data and then approximately recover the underlying cosine function by applying smoothing.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">*</span><span class="va">pi</span>, <span class="va">pi</span><span class="op">/</span><span class="fl">64</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,<span class="op">-</span><span class="fl">0.2</span>,<span class="fl">0.2</span><span class="op">)</span>
<span class="va">y_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gaussianSmooth.html">gaussianSmooth</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">6</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, pch<span class="op">=</span><span class="fl">19</span>, col<span class="op">=</span><span class="st">"grey50"</span>, xaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">*</span><span class="va">pi</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">pi</span>,<span class="fl">2</span><span class="op">*</span><span class="va">pi</span>,<span class="fl">3</span><span class="op">*</span><span class="va">pi</span>,<span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_smoothed</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/cos-smoothed-1.png" alt=""><p class="caption">plot of chunk cos-smoothed</p>
</div>
<p>It should be borne in mind that the second argument to the <code><a href="reference/gaussianSmooth.html">gaussianSmooth()</a></code> function is the <em>standard deviation</em> of the smoothing Gaussian kernel in each dimension, rather than the kernel size.</p>
<p>On our two-dimensional test image, which contains no appreciable noise, the effect is to blur the picture. Indeed, this operation is sometimes called <a href="http://en.wikipedia.org/wiki/Gaussian_blur" class="external-link">Gaussian blurring</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/gaussianSmooth.html">gaussianSmooth</a></span><span class="op">(</span><span class="va">fan</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-smoothed-1.png" alt=""><p class="caption">plot of chunk fan-smoothed</p>
</div>
<p>An alternative approach to noise reduction is <a href="http://en.wikipedia.org/wiki/Median_filter" class="external-link">median filtering</a>, and <code>mmand</code> provides another function for this purpose:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"box"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/filters.html">medianFilter</a></span><span class="op">(</span><span class="va">fan</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-median-filtered-1.png" alt=""><p class="caption">plot of chunk fan-median-filtered</p>
</div>
<p>This method is typically better at preserving edges in the image, which can be desirable in some applications.</p>
</div>
<div id="connected-components" class="section level2">
<h2 class="hasAnchor">
<a href="#connected-components" class="anchor" aria-hidden="true"></a>Connected components</h2>
<p>Every operation described so far has been based on <code>mmand</code>’s flexible <code><a href="reference/morph.html">morph()</a></code> function, which uses a kernel represented by an array to select pixels of interest in morphing the image, optionally using the kernel’s elements to adjust their values, and then applying a merge operation of some sort (sum, minimum, maximum, median, etc.) to produce the pixel value in the final image. In every case the result has the same size as the original data array.</p>
<p>In the next section we will examine operations that change the array’s dimensions, but first we consider another useful operation: finding connected components. This is the task of assigning a label to each contiguous subregion of an array.</p>
<p>To demonstrate, we start by first thresholding the fan image using <em>k</em>-means clustering (with <em>k</em>=2). The package’s <code><a href="reference/threshold.html">threshold()</a></code> function can be used for this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fan_thresholded</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/threshold.html">threshold</a></span><span class="op">(</span><span class="va">fan</span>, method<span class="op">=</span><span class="st">"kmeans"</span><span class="op">)</span>
<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="va">fan_thresholded</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-thresholded-1.png" alt=""><p class="caption">plot of chunk fan-thresholded</p>
</div>
<p>We can then find the connected components. In this case the kernel determines which pixels are deemed to be neighbours. For example,</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernels.html">shapeKernel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"box"</span><span class="op">)</span>
<span class="va">fan_components</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/components.html">components</a></span><span class="op">(</span><span class="va">fan_thresholded</span>, <span class="va">k</span><span class="op">)</span></code></pre></div>
<p>Now we can visualise the result by assigning a colour to each component.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="va">fan_components</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fan_components</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-components-1.png" alt=""><p class="caption">plot of chunk fan-components</p>
</div>
<p>As we might expect, the largest components—which label only the “on” areas of the image—correspond to (most of) the ring of fan blades, and the bright part of the central hub.</p>
<p>This is can be a useful tool for “segmentation”, or dividing an image into coherent areas.</p>
</div>
<div id="the-distance-transform" class="section level2">
<h2 class="hasAnchor">
<a href="#the-distance-transform" class="anchor" aria-hidden="true"></a>The distance transform</h2>
<p>A useful operation in certain contexts is the distance transform, which calculates the distance from each pixel to a region of interest. There are signed an unsigned variants, with the former also calculating the distance to the boundary within the region of interest itself. We can use the thresholded image from above to illustrate the point:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/distanceTransform.html">distanceTransform</a></span><span class="op">(</span><span class="va">fan_thresholded</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-distance-1.png" alt=""><p class="caption">plot of chunk fan-distance</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="reference/distanceTransform.html">distanceTransform</a></span><span class="op">(</span><span class="va">fan_thresholded</span>, signed<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-distance-2.png" alt=""><p class="caption">plot of chunk fan-distance</p>
</div>
<p>We take the absolute value of the signed transform here for ease of visual interpretation. Notice how, in both cases, bright “ridges” in the transformed image correspond to midlines at maximal distance from the boundary between foreground and background. Philip Rideout <a href="https://prideout.net/blog/distance_fields/" class="external-link">provides a detailed explanation</a> of the algorithm and its uses.</p>
</div>
<div id="resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#resampling" class="anchor" aria-hidden="true"></a>Resampling</h2>
<p>The final category of problems that <code>mmand</code> can solve uses a different type of kernel to resample an image at arbitrary points, or on a new grid. This allows images to be resized, or arrays to be indexed using non-integer indices. The kernels in these cases are functions, which provide coefficients for using data at any distance from the new pixel location to determine its value.</p>
<p>Let’s use an example to illustrate this. Consider the simple vector</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Its second element is 0, and its third element is 1, but what is its value at index 2.5? One answer is that it simply doesn’t have one, but if these were samples from a fundamentally continuous source, then there is conceptually a value everywhere. We just didn’t capture it. Our best guess would have to be that it is either 0 or 1, or something in between. If we try to use 2.5 as an index we get the value 0:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span>
<span class="co">## [1] 0</span></code></pre></div>
<p>(R simply truncates 2.5 to 2 and returns element 2.) The <code><a href="reference/resample.html">resample()</a></code> function provides a set of alternatives:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/resample.html">resample</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2.5</span>, <span class="fu"><a href="reference/kernels.html">triangleKernel</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] 0.5</span></code></pre></div>
<p>Now we obtain the value 0.5, which does not appear anywhere in the original, but it is the average of the values at locations 2 and 3. In this case, therefore, <code><a href="reference/resample.html">resample()</a></code> is performing <a href="http://en.wikipedia.org/wiki/Linear_interpolation" class="external-link">linear interpolation</a>.</p>
<p>The triangle kernel is just one possible function for interpolating the data. Another option is the box kernel, generated by <code><a href="reference/kernels.html">boxKernel()</a></code>, which simply returns the “nearest” value in the original data. Yet another option is provided by <code><a href="reference/kernels.html">mitchellNetravaliKernel()</a></code>, or <code><a href="reference/kernels.html">mnKernel()</a></code> for short, which provides a family of cubic spline kernels <a href="http://dl.acm.org/citation.cfm?id=378514" class="external-link">proposed by Mitchell and Netravali</a>. We can see the profile of any of these kernels by plotting them:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/kernels.html">mitchellNetravaliKernel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/mn-profile-1.png" alt=""><p class="caption">plot of chunk mn-profile</p>
</div>
<p>In higher dimensions, the resampled point locations can be passed to <code><a href="reference/resample.html">resample()</a></code> either as a matrix giving the points to sample at, one per row, or as a list giving the locations on each axis, which will be made into a grid.</p>
<p>A common use for resampling is to scale an image up or down. The <code><a href="reference/resample.html">rescale()</a></code> function is a convenience wrapper around <code><a href="reference/resample.html">resample()</a></code> for scaling an array by a given scale factor. Here, we can use it to scale a smaller version of the fan image up to the size of the larger version:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/loder" class="external-link">loder</a></span><span class="op">)</span>

<span class="va">fan_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/loder/man/readPng.html" class="external-link">readPng</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"fan-small.png"</span>, package<span class="op">=</span><span class="st">"mmand"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fan_small</span><span class="op">)</span>
<span class="co">## [1] 128 128   1</span>

<span class="fu"><a href="reference/display.html">display</a></span><span class="op">(</span><span class="fu"><a href="reference/resample.html">rescale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">fan_small</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fu"><a href="reference/kernels.html">mnKernel</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tools/figures/fan-scaled-1.png" alt=""><p class="caption">plot of chunk fan-scaled</p>
</div>
<p>The scaled-up image of course has less detail than the original 512x512 pixel version, since it is based on 16 times fewer data points, but the general features of the fan are perfectly discernible.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=mmand">https://​cloud.r-project.org/​package=mmand</a>
</li>
<li>Browse source code at <br><a href="https://github.com/jonclayden/mmand/">https://​github.com/​jonclayden/​mmand/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jonclayden/mmand/issues">https://​github.com/​jonclayden/​mmand/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>


<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jon Clayden <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=mmand" class="external-link"><img src="http://www.r-pkg.org/badges/version/mmand" alt="CRAN version"></a></li>
<li><a href="https://travis-ci.org/jonclayden/mmand" class="external-link"><img src="https://travis-ci.org/jonclayden/mmand.svg?branch=master" alt="Travis Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/jonclayden/mmand" class="external-link"><img src="https://ci.appveyor.com/api/projects/status/yp4nh0ubiq53n7gw?svg=true" alt="AppVeyor Build status"></a></li>
<li><a href="https://coveralls.io/github/jonclayden/mmand?branch=master" class="external-link"><img src="https://coveralls.io/repos/github/jonclayden/mmand/badge.svg?branch=master" alt="Coverage Status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Jon Clayden.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
